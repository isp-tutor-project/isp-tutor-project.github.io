var ISP_API=function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),r.d(t,"IspAPI",(function(){return l}));const s={conditionActivities:{1:["matsPreTest","diPreTest","rqSelectBL","hypoWEoneDir","diInstrGR","diCrystalGrowthTest","diPostTest","matsPostTest"],2:["matsPreTest","diPreTest","rqSelectBL","hypoWEbiDir","diInstrGR","diCrystalGrowthTest","diPostTest","matsPostTest"]}};class i{constructor(e){this.dbType=e}setCredentials(e){this.userID=e}lookupUserID(e){}loginUser(e){}registerUser(e){}getUserData(){}getActivityData(e,t=!0){}setActivityData(e,t){}getRQData(){}getCurrHypoTask(){}getInitialHypoData(){}getFinalHypoData(){}saveValue(e,t){}saveJSONValue(e,t){}getBoolValue(e){}getIntValue(e){}getFloatValue(e){}getTextValue(e){}getJSONValue(e){}}class a extends i{constructor(){super()}setCredentials(e,t){super.setCredentials(e,t)}getUserData(){console.count("getUserData() called");let e={};return Promise.all([this.getTextValue("classCode"),this.getTextValue("userID"),this.getActivityData("rqted"),this.getCurrHypoTask(),this.getIntialHypoData(),this.getFinalHypoData()]).then(([t,r,s,i,a,o])=>(e.classCode=t,e.userID=r,e.rqted=s,i&&(e.currHypoTaskIdx=i),a&&(e.firstPrediction=a.firstPrediction,e.initialHypo=a.initialHypo),o&&(e.secondPrediction=o.secondPrediction,e.finalHypo=o.finalHypo),e))}getActivityData(e,t=!0){return this.getJSONValue(e).then(e=>e&&!t?JSON.stringify(e):e)}setActivityData(e,t){return this.saveJSONValue(e,t)}getRQData(){let e=null;return this.getActivityData("rqted").then(t=>(e=t||{moduleState:{selectedArea:{index:1},selectedTopic:{index:1},selectedVariable:{index:1},selectedRQ:{index:1}}},e)).catch(t=>(console.error(t),e))}getCurrHypoTask(){return this.getIntValue("currHypoTaskIdx")}getIntialHypoData(){let e={};return this.getTextValue("firstPrediction").then(t=>null!==t?(e.firstPrediction=t,this.getJSONValue("initialHypo")):(e.firstPrediction=null,null)).then(t=>(e.initialHypo=t,e)).catch(t=>(console.error(t),e))}getFinalHypoData(){let e={};return this.getTextValue("secondPrediction").then(t=>null!==t?(e.secondPrediction=t,this.getJSONValue("finalHypo")):(e.secondPrediction=null,null)).then(t=>(e.finalHypo=t,e)).catch(t=>(console.error(t),e))}setValues(e,t=!1){return new Promise((t,r)=>{try{for(let[t,r]of Object.items(e))localStorage.setItem(t,r);t(!0)}catch(e){r(e)}})}saveValue(e,t){return new Promise((r,s)=>{try{r(localStorage.setItem(e,t))}catch(e){s(e)}})}saveJSONValue(e,t){return new Promise((r,s)=>{try{let s=JSON.stringify(t);r(localStorage.setItem(e,s))}catch(e){s(e)}})}getBoolValue(e){return new Promise((t,r)=>{try{let r=localStorage.getItem(e);void 0===r&&t(r),t("true"===r)}catch(e){r(e)}})}getIntValue(e){let t;return new Promise((r,s)=>{try{let s=localStorage.getItem(e);s&&(t=parseInt(s,10)),r(t)}catch(e){s(e)}})}getFloatValue(e){let t;return new Promise((r,s)=>{try{let s=localStorage.getItem(e);s&&(t=parseFloat(s)),r(t)}catch(e){s(e)}})}getTextValue(e){let t;return new Promise((r,s)=>{try{let s=localStorage.getItem(e);s&&(t=s),r(s)}catch(e){s(e)}})}getJSONValue(e){return new Promise((t,r)=>{try{let r=localStorage.getItem(e);r&&(r=JSON.parse(r)),t(r)}catch(e){r(e)}})}}const o={apiKey:"AIzaSyD7zIk-8V20QqJNSs0cAV0uNL3qjeqLMdM",authDomain:"isptutor.firebaseapp.com",projectId:"isptutor"};class n extends i{constructor(){super("firestore"),firebase.initializeApp(o),this.store=firebase.firestore()}setCredentials(e){super.setCredentials(e),this.userRef=this.store.collection("STUDY_3").doc(e)}getNextUserNum(){return this.store.collection("STUDY_3").doc("study_data").update({usernum:firebase.firestore.FieldValue.increment(1)}).then(()=>this.store.collection("STUDY_3").doc("study_data").get()).then(e=>e.data().usernum).catch(e=>console.error(e))}loginUser(e){let t=this.store.collection("STUDY_3").doc(e);return t.get().then(e=>!!e.exists&&(this.userRef=t,this.getUserData()))}lookupUserID(e){return this.store.collection("STUDY_3").where("classCode","==",e.classCode).where("FN","==",e.FN).where("LN","==",e.LN).where("MON","==",e.MON).where("DAY","==",e.DAY).get().then(e=>{if(1!==e.size)return!1;{console.log("record found");let t=!1,r=e.docs[0].data();return r.userID?t=r.userID:console.log("no userID field",r),t}}).catch(e=>(console.log(e),!1))}registerUser(e){let t=!1;return console.log("registering user"),this.getNextUserNum().then(r=>{let s=r%2+1,i=""+s;t=`USER${r}_${s}`;let a=Object.assign(e,{userID:t,condition:i,completedAssignments:JSON.stringify([])});return this.store.collection("STUDY_3").doc(t).set(a)}).then(()=>t).catch(e=>(console.error(e),!1))}getUserData(){let e=!1;return this.userRef.get().then(t=>{if(t.exists){let r=t.data();e={userID:r.userID,condition:r.condition,assignments:s.conditionActivities[r.condition],completedAssignments:JSON.parse(r.completedAssignments)}}return e})}markActivityAsCompleted(e){return this.userRef.get().then(e=>{let t=e.data();return JSON.parse(t.completedAssignments)}).then(t=>(t.includes(e)||t.push(e),this.userRef.update({completedAssignments:JSON.stringify(t)})))}getCurrHypoTask(){}getActivityData(e,t=!0){return this.userRef.get().then(e=>e.data()).then(r=>{if(console.log("userData",r),!r)return null;let s=r[e];return s?s&&t?JSON.parse(s):s:null}).catch(e=>(console.error(e),null))}setActivityData(e,t){let r=JSON.stringify(t);return this.userRef.update({[e]:r}).then(()=>{console.log("app data saved successefully")}).catch(e=>{console.error(e)})}setValues(e,t=!1){return this.userRef.set(e,{merge:!t})}updateValues(e){return this.userRef.update(e)}deleteValue(e){return this.userRef.update({[e]:firebase.firestore.FieldValue.delete()})}}class l{constructor(){this.activityConfig=function(){let e=JSON.parse(localStorage.getItem("currentActivity")),t={userID:localStorage.getItem("userID"),database:localStorage.getItem("database"),homepage:localStorage.getItem("homepage"),activityID:e.id,activityKey:e.key,activityFeatures:e.features.split(":").filter(e=>""!==e)};return console.log(t),t}(),this.db=function(e,t){let r;switch(e){case"firestore":r=new n;break;default:r=new a}return r}(this.activityConfig.database),this.db.setCredentials(this.activityConfig.userID)}getUserID(){return this.activityConfig.userID}getFeaturesString(){return this.activityConfig.activityFeatures.join(":")}getAppData(e=!1){return this.db.getActivityData(this.activityConfig.activityKey,e)}saveAppData(e){return this.db.setActivityData(this.activityConfig.activityKey,e)}saveAppComplete(){return this.db.markActivityAsCompleted(this.activityConfig.activityID)}goHomePage(){top.location.href=this.activityConfig.homepage}}}]);
//# sourceMappingURL=isp-api.js.map