!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0),r(1);class i{constructor(){this.el=document.querySelector("nav.navbar"),this.homeBtn=document.getElementById("navbar_home_btn"),this.activityTitle=document.getElementById("activity_title"),this.glossaryBtn=document.getElementById("navbar_glossary_btn"),this.glossaryPopup=document.querySelector(".navbar-glossary-popup"),this.signOutBtn=document.getElementById("sign_out_button"),this.signInText=document.getElementById("sign_in_text"),this.goHome=this.goHome.bind(this),this.toggleGlossary=this.toggleGlossary.bind(this),this.signOutUser=this.signOutUser.bind(this),this.homeBtn.addEventListener("click",this.goHome),this.glossaryBtn.addEventListener("click",this.toggleGlossary),this.signOutBtn.addEventListener("click",this.signOutUser)}goHome(e){let t=this.calcHomePage();this.redirectTo(t)}toggleGlossary(e){this.glossaryPopup.classList.toggle("hidden")}calcHomePage(){let e=localStorage.getItem("homepage");return null===e&&(e=window.location.origin+"/"),e}redirectTo(e){window.location.href!==e&&(window.location.href=e)}signOutUser(e){this.signInText.innerHTML="",this.signInText.classList.add("invisible"),this.signOutBtn.classList.add("invisible");let t=this.calcHomePage();localStorage.clear(),this.redirectTo(t)}displayActivityTitle(e){this.activityTitle.innerText=e.toUpperCase()}displayUser(e){this.signInText.innerHTML="Welcome, "+e,this.signInText.classList.remove("invisible"),this.signOutBtn.classList.remove("invisible")}}r(2);class n{constructor(e){this.el=document.getElementById(e||"snackbar")}show(e){null!=e&&(this.el.innerHTML=e,this.el.classList.add("show"),setTimeout(()=>{this.el.classList.remove("show")},3e3))}}class a{constructor(){}setCredentials(e,t){this.classCode=e,this.userID=t}getUserData(){}getActivityData(e,t=!0){}setActivityData(e,t){}getRQData(){}getCurrHypoTask(){}getInitialHypoData(){}getFinalHypoData(){}saveValue(e,t){}saveJSONValue(e,t){}getBoolValue(e){}getIntValue(e){}getFloatValue(e){}getTextValue(e){}getJSONValue(e){}}class s extends a{constructor(){super()}setCredentials(e,t){super.setCredentials(e,t)}getUserData(){console.count("getUserData() called");let e={};return Promise.all([this.getTextValue("classCode"),this.getTextValue("userID"),this.getActivityData("rqted"),this.getCurrHypoTask(),this.getIntialHypoData(),this.getFinalHypoData()]).then(([t,r,i,n,a,s])=>(e.classCode=t,e.userID=r,e.rqted=i,n&&(e.currHypoTaskIdx=n),a&&(e.firstPrediction=a.firstPrediction,e.initialHypo=a.initialHypo),s&&(e.secondPrediction=s.secondPrediction,e.finalHypo=s.finalHypo),e))}getActivityData(e,t=!0){return this.getJSONValue(e).then(e=>e&&!t?JSON.stringify(e):e)}setActivityData(e,t){return this.saveJSONValue(e,t)}getRQData(){let e=null;return this.getActivityData("rqted").then(t=>(e=t||{moduleState:{selectedArea:{index:1},selectedTopic:{index:1},selectedVariable:{index:1},selectedRQ:{index:1}}},e)).catch(t=>(console.error(t),e))}getCurrHypoTask(){return this.getIntValue("currHypoTaskIdx")}getIntialHypoData(){let e={};return this.getTextValue("firstPrediction").then(t=>null!==t?(e.firstPrediction=t,this.getJSONValue("initialHypo")):(e.firstPrediction=null,null)).then(t=>(e.initialHypo=t,e)).catch(t=>(console.error(t),e))}getFinalHypoData(){let e={};return this.getTextValue("secondPrediction").then(t=>null!==t?(e.secondPrediction=t,this.getJSONValue("finalHypo")):(e.secondPrediction=null,null)).then(t=>(e.finalHypo=t,e)).catch(t=>(console.error(t),e))}setValues(e,t=!1){return new Promise((t,r)=>{try{for(let[t,r]of Object.items(e))localStorage.setItem(t,r);t(!0)}catch(e){r(e)}})}saveValue(e,t){return new Promise((r,i)=>{try{r(localStorage.setItem(e,t))}catch(e){i(e)}})}saveJSONValue(e,t){return new Promise((r,i)=>{try{let i=JSON.stringify(t);r(localStorage.setItem(e,i))}catch(e){i(e)}})}getBoolValue(e){return new Promise((t,r)=>{try{let r=localStorage.getItem(e);void 0===r&&t(r),t("true"===r)}catch(e){r(e)}})}getIntValue(e){let t;return new Promise((r,i)=>{try{let i=localStorage.getItem(e);i&&(t=parseInt(i,10)),r(t)}catch(e){i(e)}})}getFloatValue(e){let t;return new Promise((r,i)=>{try{let i=localStorage.getItem(e);i&&(t=parseFloat(i)),r(t)}catch(e){i(e)}})}getTextValue(e){let t;return new Promise((r,i)=>{try{let i=localStorage.getItem(e);i&&(t=i),r(i)}catch(e){i(e)}})}getJSONValue(e){return new Promise((t,r)=>{try{let r=localStorage.getItem(e);r&&(r=JSON.parse(r)),t(r)}catch(e){r(e)}})}}const o={apiKey:"AIzaSyD7zIk-8V20QqJNSs0cAV0uNL3qjeqLMdM",authDomain:"isptutor.firebaseapp.com",projectId:"isptutor"};class l extends a{constructor(){super(),firebase.initializeApp(o),this.store=firebase.firestore()}setCredentials(e,t){super.setCredentials(e,t),this.userRef=this.store.collection(this.classCode).doc(this.userID)}getUserData(){return this.userRef.get().then(e=>e.exists?e.data:null)}getCurrHypoTask(){}getActivityData(e,t=!0){return this.getUserData().then(r=>{let i=r[e];return i&&t?JSON.parse(i):i})}setValues(e,t=!1){return this.userRef.set(e,{merge:!t})}updateValues(e){return this.userRef.update(e)}deleteValue(e){return this.userRef.update({[e]:firebase.firestore.FieldValue.delete()})}}const c=[{label:"Science Attitudes - Initial",phase:"pre-training",storageInfo:{currentActivity:"matsPreTest",currentActivityFeatures:"FTR_WEB:FTR_PRE"},url:"",implemented:!1},{label:"Data Interpretation Questions - Initial",phase:"pre-training",storageInfo:{currentActivity:"diPreTest"},url:"/apps/di-prepost/pretest.html",implemented:!0},{label:"See research question and trial run of experiment",phase:"rqSelect",storageInfo:{currentActivity:"rqSelect",currentActivityFeatures:"FTR_WEB:FTR_BASELINE:FTR_NCCRYSTAL"},url:"/edforge/rqSelect.html",implemented:!1},{label:"Research Question Selection (No Choice Crystal)",phase:"rqSelect",storageInfo:{currentActivity:"rqSelect",currentActivityFeatures:"FTR_WEB:FTR_NOCHOICE:FTR_NCCRYSTAL"},url:"/edforge/rqSelect.html",implemented:!1},{label:"Research Question Selection (Choice)",phase:"rqSelect",storageInfo:{currentModule:"rqSelect",currentActivityFeatures:"FTR_WEB:FTR_CHOICE"},url:"/edforge/rqSelect.html",implemented:!1},{label:"Hypothesis (definition pages only)",phase:"reference",storageInfo:{currentActivity:"hypoDefs",currentActivityFeatures:"FTR_WEB:FTR_DEFS_ONLY"},url:"/apps/hypo-gr/",implemented:!1},{label:"Hypothesis (Initial Hypo w/o CptMap)",phase:"hypo",storageInfo:{currentActivity:"initialHypo",currentActivityFeatures:"FTR_WEB:FTR_INITIAL_HYP:FTR_NOCPTMAP"},url:"/apps/hypo-gr/",implemented:!1},{label:"Hypothesis (Initial Hypo with CptMap)",phase:"hypo",storageInfo:{currentActivity:"initialHypo",currentActivityFeatures:"FTR_WEB:FTR_INITIAL_HYP"},url:"/apps/hypo-gr/",implemented:!1},{label:"Hypothesis (Initial Hypo Bi-Directional)",phase:"hypo",storageInfo:{currentActivity:"initialHypo",currentActivityFeatures:"FTR_WEB:FTR_INITIAL_HYP:FTR_BI_DIR"},url:"/apps/hypo-gr/",implemented:!1},{label:"Hypothesis (final hypothesis)",phase:"hypo",storageInfo:{currentActivity:"finalHypo",currentActivityFeatures:"FTR_WEB:FTR_FINAL_HYP:FTR_NO_DEFS"},url:"/apps/hypo-gr/",implemented:!1},{label:"Watch students talk about their hypotheses (one-directional)",phase:"hypo",storageInfo:{currentActivity:"hypoWE",currentActivityFeatures:"FTR_ONE_DIRECTIONAL"},url:"/apps/hypo-we/",implemented:!0},{label:"Watch students talk about their hypotheses (bi-directional)",phase:"hypo",storageInfo:{currentActivity:"hypoWE",currentActivityFeatures:"FTR_BI_DIRECTIONAL"},url:"/apps/hypo-we/",implemented:!0},{label:"Lesson on Data Interpretation",phase:"data-interpretation",storageInfo:{currentActivity:"diInstruction"},url:"/apps/di-instr/",implemented:!0},{label:"Interpret results on crystal growth",phase:"post-training",storageInfo:{currentActivity:"diCrysGr"},url:"/apps/di-prepost/crystal.html",implemented:!0},{label:"Science Attitudes - Final",phase:"post-training",storageInfo:{currentActivity:"matsPostTest",currentActivityFeatures:"FTR_WEB:FTR_POST"},url:"",implemented:!1},{label:"Data Interpretation Questions - Final",phase:"post-training",storageInfo:{currentActivity:"diPostTest"},url:"/apps/di-prepost/posttest.html",implemented:!0}];function u(e){return document.getElementById(e)}let d,p,g,h,y;const m=u("login_button"),f=u("register_button"),v=u("l-back-button"),I=u("r-back-button"),b=u("login_form"),T=u("login_submit"),A=u("registration_form"),_=u("registration_submit"),S=u("activity_btns_list");function F(e){for(let t of document.querySelectorAll(".page"))t.id===e?t.classList.add("active"):t.classList.remove("active")}function H(e){let t=e.target.getAttribute("data-url"),r=e.target.getAttribute("data-activity"),i=e.target.getAttribute("data-activity-features");console.log(`\n    hovering over: ${e.target}\n    url: ${t}\n    currentActivity: ${r}\n    currentActivityFeatures: ${i}\n    `)}function D(e){e.preventDefault();let t=e.target.getAttribute("data-url"),r=e.target.getAttribute("data-activity"),i=e.target.getAttribute("data-activity-features");localStorage.setItem("currentActivity",r),localStorage.setItem("currentActivityFeatures",i),window.location.href=t}function E(e){e&&e.preventDefault(),F("index_page")}function w(e){e&&e.preventDefault(),F("home_page"),h.displayUser(p),S.innerHTML="",c.forEach(e=>{if(e.implemented){let t,r=document.createElement("li"),i=document.createElement("button");if(i.classList.add("activity-button"),i.classList.add("btn"),i.type="button",i.innerHTML=e.label,e.url.startsWith("http"))t=e.url;else{let r=localStorage.getItem("homepage");r=r.replace("index.html",""),r.endsWith("/")&&(r=r.slice(0,-1)),t=`${r}${e.url}`}i.setAttribute("data-activity-features",e.storageInfo.currentActivityFeatures||""),i.setAttribute("data-activity",e.storageInfo.currentActivity),i.setAttribute("data-url",t),i.addEventListener("click",D),i.addEventListener("mouseover",H),r.appendChild(i),S.appendChild(r)}})}function C(){console.debug("Account found"),y.show("Signed in as "+p+"."),w()}function P(e,t){return 2===e.length||(y.show("Please enter exactly two letters for your "+t),!1)}function R(e,t){let r={};if(["classcode","fname","lname","bmonth","bday"].forEach(t=>r[t]=`${e}_${t}`),!t.reportValidity())return!1;d=u(r.classcode).value.toUpperCase();let i=u(r.fname).value,n=u(r.lname).value,a=u(r.bmonth).value,s=u(r.bday).value;return!!P(i,"first name")&&(!!P(n,"last name")&&(p=i+n,!(!/^[A-Za-z]+$/.test(p)&&(y.show("Please do not enter any numbers, spaces, or special characters in your input."),1))&&(p+="_"+a+"_"+s,p=p.toUpperCase(),localStorage.setItem("classCode",d),localStorage.setItem("userID",p),!0)))}m.addEventListener("click",(function(e){e&&e.preventDefault(),F("login_page"),b.reset()})),f.addEventListener("click",(function(e){e&&e.preventDefault(),F("registration_page"),A.reset()})),v.addEventListener("click",E),I.addEventListener("click",E),T.addEventListener("click",e=>{e.preventDefault(),R("login",b)&&(g.setCredentials(d,p),g.getUserData().then(e=>{e?C():(console.error("No such account!"),y.show("No such account exists. Check that your name and birthday were typed in correctly."))}).catch((function(e){console.log("Error getting account:",e),y.show("No such account exists. Check that you typed in the classcode correctly.")})))}),_.addEventListener("click",e=>{e.preventDefault(),R("register",A)&&(g.setCredentials(d,p),g.getUserData().then(e=>{if(e){let e="Account already exists.";console.error(e),y.show(e)}else console.debug("Creating account"),g.setValues({classCode:d,userID:p}).then((function(){console.debug("Document successfully written!"),C()})).catch((function(e){let t="Error creating new account.";console.error(t,e),y.show(t)}))}).catch((function(e){console.error("Error getting account:",e),y.show("Cannot create account. Please make sure that class code is correct.")})))}),function(){h=new i,y=new n;let e="localstorage",t=window.location.href;localStorage.setItem("homepage",t),localStorage.setItem("database",e),g=function(e){let t;switch(e){case"firestore":t=new l;break;default:t=new s}return t}(e),d=localStorage.getItem("classCode"),p=localStorage.getItem("userID"),d&&p?w():E()}()}]);
//# sourceMappingURL=homepage.bundle.js.map